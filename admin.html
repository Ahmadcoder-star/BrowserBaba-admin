<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Admin Upload - Browser Baba</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Custom CSS */
    .image-card {
      /* Slightly darker card background */
      background-color: #343a40 !important;
      border-radius: 8px;
      overflow: hidden;
      /* Important for button overlay */
      position: relative;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .image-card:hover {
      transform: translateY(-5px);
      /* Lift effect on hover */
      box-shadow: 0 1rem 3rem rgba(0, 0, 0, .5) !important;
      /* Stronger shadow */
    }

    /* Delete Button Overlay Styling */
    .overlay-delete {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      /* Initially hide the button */
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .image-card:hover .overlay-delete {
      opacity: 1;
      /* Show button on hover */
    }
  </style>
</head>

<body class="bg-dark text-light p-4">
  <div class="container">
    <h2>Admin Panel - Upload / Delete</h2>

    <form id="uploadForm" class="mb-4">
      <div class="input-group mb-3">
        <input type="file" id="imageInput" name="image" accept="image/*" required style="display: none;">

        <label for="imageInput"
          class="btn btn-outline-info flex-grow-1 me-2 d-flex align-items-center justify-content-center">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
            class="bi bi-folder-fill me-2" viewBox="0 0 16 16">
            <path
              d="M9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.826a2 2 0 0 1-1.991-1.819l-.637-7a1.99 1.99 0 0 1 .342-1.31L.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3" />
          </svg>
          <span id="fileChosenText">Choose Image File...</span>
        </label>

        <button class="btn btn-success" type="submit">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
            class="bi bi-cloud-upload-fill me-1" viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M8 0a6 6 0 0 0-4.332 9.47 5.145 5.145 0 0 0-1.878-.45A4.5 4.5 0 0 0 .5 14.5a.5.5 0 0 0 1 0v-.5a3.5 3.5 0 1 1 5.997-.997A.5.5 0 0 0 7 13.5v-.5a.5.5 0 0 0-1 0v.5a.5.5 0 0 0 .5.5a.5.5 0 0 0 1 0a.5.5 0 0 0 .5-.5V10h-.5a.5.5 0 0 0 0 1h.5v2h-.5a.5.5 0 0 0 0 1h.5v1h-.5a.5.5 0 0 0 0 1h.5a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h.5a.5.5 0 0 0 .5-.5V10h-.5a.5.5 0 0 0 0 1h.5v2h-.5a.5.5 0 0 0 0 1h.5v1h-.5a.5.5 0 0 0 0 1h.5a.5.5 0 0 0 .5-.5V10h-.5a.5.5 0 0 0 0 1h.5v2h-.5a.5.5 0 0 0 0 1h.5v1a.5.5 0 0 0 1 0v-1a.5.5 0 0 0 .5-.5V9.47A6 6 0 0 0 8 0" />
          </svg>
          Upload
        </button>
      </div>
    </form>

    <h4 class="mt-4">Gallery</h4>
    <div id="gallery" class="row g-3"></div>
  </div>

  <script>
    const API = "http://localhost:5000"; // server base URL

    // Upload form
    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const file = document.getElementById("imageInput").files[0];
      if (!file) return alert("Choose a file");
      const fd = new FormData();
      fd.append("image", file);
      const res = await fetch(API + "/upload", { method: "POST", body: fd });
      const data = await res.json();
      if (data.error) return alert("Upload error: " + data.error);
      alert("Uploaded!");
      loadGallery();
    });

    // Load gallery by calling server
    async function loadGallery() {
      const res = await fetch(API + "/images");
      const images = await res.json();
      const grid = document.getElementById("gallery");
      grid.innerHTML = "";
      images.forEach(img => {
        const col = document.createElement("div");
        col.className = "col-md-4 col-lg-3"; // Zyada columns (chote cards)
        col.innerHTML = `
        <div class="card image-card border-0 shadow-sm"> 
            <img src="${img.url}" class="card-img-top" style="height:200px;object-fit:cover;">
            
            <div class="overlay-delete">
                <button class="btn btn-sm btn-danger rounded-0 w-100" 
                        onclick="deleteImage('${img.public_id}')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill me-1" viewBox="0 0 16 16">
                      <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7.5a1 1 0 0 0-1 1z"/>
                    </svg>
                    DELETE
                </button>
            </div>
            
        </div>`;
        grid.appendChild(col);
      });
    }

    async function deleteImage(publicId) {
      if (!confirm("Delete this image?")) return;
      const res = await fetch(API + "/delete/" + encodeURIComponent(publicId), { method: "DELETE" });
      const data = await res.json();
      if (data.error) return alert("Delete error: " + data.error);
      alert("Deleted!");
      loadGallery();
    }

    // Initial load
    loadGallery();

    document.getElementById("imageInput").addEventListener("change", (e) => {
      const fileName = e.target.files[0] ? e.target.files[0].name : "Choose Image File...";
      document.getElementById("fileChosenText").textContent = fileName;
    });


  </script>
</body>

</html>